echo "BEGINNING"
args=("$@")

treebank=${args[0]}
grammar=${args[1]}
iterations=${args[2]}

bitpar_grammar=grammar.bitpar
bitpar_lexicon=lexicon.bitpar
unique_treebank=unique_treebank
corpus=corpus
em=em
grammar_ext=.grammar
lexicon_ext=.lexicon
parses=parses

echo "REORDER GRAMMAR"
./reorder_grammar $grammar $bitpar_grammar
echo "CREATE LEXICON"
./create_lexicon $bitpar_grammar $bitpar_lexicon
echo "REMOVE LEX RULES"
./remove_lex_rules $bitpar_grammar
echo "CREATE UNIQUE TREEBANK"
./create_unique_treebank $treebank $unique_treebank
echo "CREATE CORPUS"
./create_corpus $treebank $corpus

echo "IO ITERATION"
bitpar -s TOP $bitpar_grammar $bitpar_lexicon $corpus -em $em

echo "REMOVE ZEROS"
./remove_zeros $em

./compute_loglikelihood $em$grammar_ext $em$lexicon_ext $corpus


cp $treebank gold_treebank
./remove_lex_rules gold_treebank
bitpar -b 1 -s TOP $em$grammar_ext $em$lexicon_ext $corpus parses
java -jar ../../evalC_25_5_10/evalC/evalC.jar gold_treebank parses output >> final_scores

#while [ $iterations -gt 0 ]; do
#	./em_iterations $em $corpus 1 
#	let iterations=iterations-1
#done
let iterations=iterations-1
./em_iterations $em $corpus $iterations

#echo "PARSES"
#bitpar -b 1 -s TOP $em$grammar_ext $em$lexicon_ext $corpus $parses

